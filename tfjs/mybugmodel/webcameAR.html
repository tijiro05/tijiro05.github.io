<a-scene embedded vr-mode-ui="enabled: false" ar-mode="false">
    <a-box id="cloverObj" position="0 0 -1" visible="false" scale="0.5 0.5 0.5" color="#4CAF50" look-at="[camera]" dynamic-position></a-box>

    <a-entity id="cameraRig" position="0 0 0">
        <a-entity id="mainCamera" camera look-controls position="0 1.6 0"></a-entity>
    </a-entity>

    <a-assets>
        <a-asset-item id="notojpFont" src="fonts/MPLUSRounded1c-Black.ttf"></a-asset-item>
    </a-assets>

    <a-entity id="cloverText" visible="false" scale="0.5 0.5 0.5" look-at="[camera]" camera-facing>
        <a-plane color="#5A3E2B" width="2.7" height="1.4" position="0 0 -0.06" material="shader: flat"></a-plane>
        <a-plane color="#2E4E3F" width="2.5" height="1.2" position="0 0 -0.05" material="shader: flat"></a-plane>
        <a-troika-text id="bubbleText" font="#notojpFont" value="ここに結果が表示されます"
                       font-size="0.12" color="#FFFFFF" textAlign="center" position="0 0 0.06"></a-troika-text>
    </a-entity>
</a-scene>

<script>
const cloverText = document.getElementById('cloverText');
const cloverObj = document.getElementById('cloverObj');
const bubbleText = document.getElementById('bubbleText');
const camera = document.querySelector('#mainCamera');

function showCloverAR(text) {
    if(!camera) return;

    // クローバーオブジェクト位置更新
    const camPos = new THREE.Vector3();
    camera.object3D.getWorldPosition(camPos);
    const camDir = new THREE.Vector3(0,0,-1).applyQuaternion(camera.object3D.quaternion);
    const targetPos = camPos.clone().add(camDir.multiplyScalar(1.5));
    cloverObj.setAttribute('position', targetPos);
    cloverObj.setAttribute('visible', true);

    // 黒板をクローバーオブジェクトに相対配置
    cloverText.setAttribute('position', {
        x: targetPos.x,
        y: targetPos.y + 0.7,  // 少し上に
        z: targetPos.z + 0.05  // 手前に
    });
    bubbleText.setAttribute('value', text);
    cloverText.setAttribute('visible', true);
}

// クローバー以外は文字のみ
function showLabelOnly(text) {
    cloverObj.setAttribute('visible', false);
    cloverText.setAttribute('position', {x:0,y:1.5,z:-1.2});
    bubbleText.setAttribute('value', text);
    cloverText.setAttribute('visible', true);
}
</script>
